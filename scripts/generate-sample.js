const XLSX = require('xlsx');
const path = require('path');

// 샘플 데이터 생성 (다양한 테스트 케이스 포함)
const data = [
  // 헤더 (19개 컬럼)
  ['이름', '생년월일', '재해일자', '키', '몸무게', '성별', '병원명', '진료과', '담당의', '특이사항', '복귀고려사항', '진단코드', '진단명', '부위', '직종명', '시작일', '종료일', '중량물(kg)', '쪼그려앉기(분)'],

  // === 케이스 1: 완전 새 환자들 (6명) ===
  ['김철수', '1965-03-15', '2024-01-10', 172, 75, '남', '서울대병원', '정형외과', '이의사', '고혈압', '중량물 제한', 'M17.1', '일차성 무릎관절증', '우측', '건설현장 철근공', '1990-03-01', '2024-01-10', 2500, 180],
  ['이영희', '1970-08-22', '2024-02-15', 158, 62, '여', '연세세브란스', '재활의학과', '박의사', '당뇨', '장시간 서있기 제한', 'M17.1', '일차성 무릎관절증', '양측', '식당조리사', '1995-06-15', '2024-02-15', 500, 240],
  ['박민수', '1968-11-30', '2024-03-20', 175, 82, '남', '삼성서울병원', '정형외과', '김의사', '', '쪼그려앉기 금지', 'M23.2', '반월상연골손상', '좌측', '배관설비공', '1988-04-01', '2024-03-20', 1800, 150],
  ['정미경', '1972-05-18', '2024-04-05', 162, 58, '여', '아산병원', '정형외과', '최의사', '퇴행성관절염 가족력', '', 'M17.0', '원발성 무릎관절증', '우측', '청소원', '2000-01-15', '2024-04-05', 300, 200],
  ['최동훈', '1960-12-25', '2024-05-12', 168, 70, '남', '고대병원', '재활의학과', '정의사', '허리디스크 기왕력', '계단 사용 제한', 'M17.1', '일차성 무릎관절증', '양측', '택배기사', '1985-07-01', '2024-05-12', 2000, 90],
  ['한지수', '1975-09-08', '2024-06-18', 170, 68, '여', '서울아산병원', '정형외과', '윤의사', '', '', 'M23.3', '반월상연골병변', '좌측', '간호조무사', '1998-03-01', '2024-06-18', 400, 120],

  // === 케이스 2: 동일인 + 다른 상병 (김철수의 다른 상병) ===
  ['김철수', '1965-03-15', '2024-01-10', 172, 75, '남', '서울대병원', '정형외과', '이의사', '', '', 'M17.1', '일차성 무릎관절증', '좌측', '건설현장 철근공', '1990-03-01', '2024-01-10', 2500, 180],
  ['김철수', '1965-03-15', '2024-01-10', 172, 75, '남', '서울대병원', '정형외과', '이의사', '', '', 'M23.2', '반월상연골손상', '우측', '건설현장 철근공', '1990-03-01', '2024-01-10', 2500, 180],

  // === 케이스 3: 동일인 + 같은 상병 + 다른 직종 (이영희의 다른 직종) ===
  ['이영희', '1970-08-22', '2024-02-15', 158, 62, '여', '연세세브란스', '재활의학과', '박의사', '', '', 'M17.1', '일차성 무릎관절증', '양측', '마트 진열원', '2010-01-01', '2020-12-31', 800, 180],
  ['이영희', '1970-08-22', '2024-02-15', 158, 62, '여', '연세세브란스', '재활의학과', '박의사', '', '', 'M17.1', '일차성 무릎관절증', '양측', '공장조립원', '2005-03-01', '2009-12-31', 600, 160],

  // === 케이스 4: 동일인 + 같은 상병 + 같은 직종 (중복 - 건너뜀 테스트) ===
  ['박민수', '1968-11-30', '2024-03-20', 175, 82, '남', '삼성서울병원', '정형외과', '김의사', '', '', 'M23.2', '반월상연골손상', '좌측', '배관설비공', '1988-04-01', '2024-03-20', 1800, 150],

  // === 추가 신규 환자들 (8명) ===
  ['송은주', '1978-02-14', '2024-07-01', 165, 55, '여', '분당서울대병원', '정형외과', '강의사', '류마티스 의심', '반복동작 제한', 'M17.1', '일차성 무릎관절증', '우측', '미용사', '2003-05-01', '2024-07-01', 200, 300],
  ['강성민', '1963-07-20', '2024-08-10', 178, 88, '남', '인하대병원', '재활의학과', '조의사', '비만', '체중감량 필요', 'M17.0', '원발성 무릎관절증', '양측', '화물차 운전기사', '1985-01-01', '2024-08-10', 1500, 60],
  ['윤서연', '1980-04-05', '2024-09-15', 160, 52, '여', '강남세브란스', '정형외과', '서의사', '', '', 'M23.5', '만성불안정성', '좌측', '유치원교사', '2005-09-01', '2024-09-15', 300, 250],
  ['임재혁', '1955-10-12', '2024-10-20', 170, 73, '남', '서울성모병원', '정형외과', '한의사', '심장질환', '과격한 운동 금지', 'M17.1', '일차성 무릎관절증', '양측', '경비원', '2000-01-01', '2024-10-20', 100, 180],
  ['조미래', '1982-06-30', '2024-11-05', 163, 60, '여', '이대목동병원', '재활의학과', '문의사', '', '야간근무 제한', 'M17.1', '일차성 무릎관절증', '우측', '공장 품질검사원', '2008-02-01', '2024-11-05', 400, 200],
  ['오준영', '1967-01-25', '2024-12-01', 174, 78, '남', '경희대병원', '정형외과', '배의사', '통풍', '', 'M23.2', '반월상연골손상', '우측', '농업종사자', '1990-01-01', '2024-12-01', 2200, 280],
  ['배수진', '1973-12-08', '2024-12-15', 157, 48, '여', '순천향병원', '재활의학과', '임의사', '골다공증', '넘어짐 주의', 'M17.0', '원발성 무릎관절증', '좌측', '가사도우미', '1998-06-01', '2024-12-15', 350, 220],
  ['신동욱', '1958-08-18', '2025-01-05', 176, 85, '남', '건국대병원', '정형외과', '양의사', '당뇨, 고혈압', '합병증 주의', 'M17.1', '일차성 무릎관절증', '양측', '제조업 반장', '1980-03-01', '2025-01-05', 1800, 150],

  // === 복합 케이스: 신규 환자인데 여러 상병/직종 (홍길동) ===
  ['홍길동', '1966-04-10', '2025-01-10', 171, 72, '남', '세종병원', '정형외과', '권의사', '양쪽 무릎 모두 심함', '휠체어 사용 권고', 'M17.1', '일차성 무릎관절증', '우측', '타일공', '1988-01-01', '2020-12-31', 2800, 320],
  ['홍길동', '1966-04-10', '2025-01-10', 171, 72, '남', '세종병원', '정형외과', '권의사', '', '', 'M17.1', '일차성 무릎관절증', '좌측', '타일공', '1988-01-01', '2020-12-31', 2800, 320],
  ['홍길동', '1966-04-10', '2025-01-10', 171, 72, '남', '세종병원', '정형외과', '권의사', '', '', 'M23.2', '반월상연골손상', '우측', '미장공', '2021-01-01', '2025-01-10', 2000, 250],
];

// 워크북 생성
const wb = XLSX.utils.book_new();
const ws = XLSX.utils.aoa_to_sheet(data);

// 컬럼 너비 설정
ws['!cols'] = [
  { wch: 10 }, // 이름
  { wch: 12 }, // 생년월일
  { wch: 12 }, // 재해일자
  { wch: 5 },  // 키
  { wch: 7 },  // 몸무게
  { wch: 5 },  // 성별
  { wch: 15 }, // 병원명
  { wch: 12 }, // 진료과
  { wch: 8 },  // 담당의
  { wch: 20 }, // 특이사항
  { wch: 20 }, // 복귀고려사항
  { wch: 10 }, // 진단코드
  { wch: 20 }, // 진단명
  { wch: 6 },  // 부위
  { wch: 18 }, // 직종명
  { wch: 12 }, // 시작일
  { wch: 12 }, // 종료일
  { wch: 12 }, // 중량물
  { wch: 15 }, // 쪼그려앉기
];

XLSX.utils.book_append_sheet(wb, ws, '환자데이터');

// 파일 저장
const outputPath = path.join(__dirname, '..', 'sample_import.xlsx');
XLSX.writeFile(wb, outputPath);

console.log('샘플 파일 생성 완료:', outputPath);
console.log('');
console.log('=== 테스트 케이스 요약 ===');
console.log('총 행 수: 22행 (헤더 제외 21행)');
console.log('');
console.log('1. 신규 환자: 6명 (김철수, 이영희, 박민수, 정미경, 최동훈, 한지수)');
console.log('2. 김철수: 동일인 + 다른 상병 2건 (좌측 관절증, 우측 반월상연골)');
console.log('3. 이영희: 동일인 + 같은 상병 + 다른 직종 2건 (마트 진열원, 공장조립원)');
console.log('4. 박민수: 완전 중복 1건 (건너뜀 예상)');
console.log('5. 추가 신규 환자: 8명');
console.log('6. 홍길동: 신규 환자 + 다중 상병(3건) + 다중 직종(2건)');
console.log('');
console.log('=== 예상 결과 ===');
console.log('- 신규 환자: 15명');
console.log('- 추가 상병: 4건 (김철수 2건 + 홍길동 2건)');
console.log('- 추가 직종: 3건 (이영희 2건 + 홍길동 1건)');
console.log('- 중복 건너뜀: 1건 (박민수)');
